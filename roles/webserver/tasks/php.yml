- name: Install common PHP dependencies
  action: ${ansible_pkg_mgr} pkg=${item} state=installed update_cache=yes
  with_items:
    - php-mime-type
    - php5-cli
    - php5-gd
    - php5-intl
    - php5-mcrypt
  when_boolean: ${with_php}

- name: Instal local PHP configuration
  action: template src=php/php-config.ini.j2 dest=/etc/php5/conf.d/99-local-config.ini owner=root group=root mode=0644
  when_boolean: ${with_php}

- name: Create system checks directory /etc/php5/syscheck.d
  action: file path=/etc/php5/syscheck.d owner=root group=root mode=0755 state=directory
  when_boolean: ${with_php}

- name: Install phpinfo system check
  action: template src=php/phpinfo.php dest=/etc/php5/syscheck.d/index.php owner=root group=root mode=0644
  when_boolean: ${with_php}

- name: Install PHP APC extension
  action: ${ansible_pkg_mgr} pkg=php-apc state=installed update_cache=yes
  when_boolean: ${with_php_apc}

- name: Install php-apc system check
  action: template src=php/apc.php dest=/etc/php5/syscheck.d/apc.php owner=root group=root mode=0644
  when_boolean: ${with_php_apc}

- name: Install MySQL extension for PHP
  action: ${ansible_pkg_mgr} pkg=php5-mysqlnd state=installed update_cache=yes
  when_boolean: ${with_mysql} and ${with_php}

- name: Install PHPMyAdmin
  action: ${ansible_pkg_mgr} pkg=phpmyadmin state=installed update_cache=yes
  when_boolean: ${with_phpmyadmin}
